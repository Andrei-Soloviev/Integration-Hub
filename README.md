## Термины

Integration Hub — сервис управления интеграциями, который позволяет обеспечить управление интеграциями и гарантированную доставку событий между системами.

Асинхронная доставка — означает, что отправка события в целевую систему происходит независимо от доступности этой системы. В случае ошибки доставки применяется политика повторных попыток с временной изоляцией и сохранением сообщения до успешной обработки или перевода в отдельное состояние

## Проблема

Необходимо разработать сервис управления интеграциями, который позволяет обеспечить управление интеграциями и гарантированную доставку событий между системами. Даже если какой-то сервис упадет, сервис будет выполнять повторные попытки доставки в соответствии с заданной политикой до успешной обработки события.

## Цель

Разработать сервис управления интеграциями, который позволяет обеспечить управление интеграциями и гарантированную доставку событий между системами.

## Результаты

Результатом является сервис управления интеграциями между информационными системами, который позволяет обеспечить управление интеграциями и гарантированную доставку событий между системами.

Эффектом от внедрения сервиса является целостность и полнота данных. Если данные при передаче между сервисами будут утеряны, последствия от этого будут непредсказуемы. Например, нарушения обмена данными между сервисом бронирования билетов и турфирмой может привести к тому, что информация о бронировании билетов пользователем не будет сохранена в турфирме из-за чего пользователь не сможет отправится в тур.

## Идея сервиса

Integration Hub — это сервис управления асинхронными интеграциями между информационными системами, обеспечивающий гарантированную доставку событий и контроль состояния их обработки.

Сервис принимает события от источников (например, Okdesk) по HTTP API, валидирует и сохраняет их в неизменяемом виде.  После приёма события проходят асинхронную обработку, включающую управление их состоянием, применение политики повторных попыток и контроль доставки в целевые системы с использованием брокера сообщений.

В случае недоступности целевой системы Integration Hub выполняет повторные попытки доставки в соответствии с настраиваемой политикой повторов. Сообщения сохраняются до успешной обработки или перевода в отдельное состояние (например, dead-letter), что исключает потерю данных.

Сервис предоставляет механизм отслеживания статуса доставки событий, а также изоляцию ошибок отдельных интеграций, что позволяет сбоям одной системы не влиять на работу остальных.

### Гарантии доставки

Integration Hub обеспечивает следующие гарантии:

1. **At-least-once delivery**
    
    Каждое событие будет доставлено в целевую систему как минимум один раз. Возможны повторные доставки, которые должны корректно обрабатываться целевой системой.
    
2. **Идемпотентность обработки**
    
    Каждое событие имеет уникальный идентификатор, позволяющий целевым системам безопасно обрабатывать повторные сообщения без побочных эффектов.
    
3. **Неизменяемость данных**
    
    Payload события сохраняется и передаётся в неизменном виде с момента приёма до успешной обработки.
    
4. **Контролируемые повторные попытки**
    
    Для каждой интеграции применяется настраиваемая политика повторных попыток с задержками и ограничением количества повторов.
    
5. **Изоляция ошибок**
    
    Ошибки доставки в одну целевую систему не влияют на обработку событий для других интеграций.
    
6. **Dead-letter queue**
    
    Сообщения, которые не удалось доставить после исчерпания всех попыток, переводятся в отдельное состояние для последующего анализа или повторной обработки.
    

## Бизнес-сценарии

### Биллинг ТС Okdesk

Компания  “Рога и копыта” разработало приложение “Биллинг ТС”, которое реализует автоматическую подготовку счетов на абонентское обслуживание в Okdesk. Автоматическая подготовка счетов инициируется созданием в Okdesk соответствующей заявки.

Integration Hub позволит гарантировать, что даже если приложение “Биллинг ТС” упадет, созданные в Okdesk заявки будут обработаны приложением “Биллинг ТС”, когда оно будет восстановлено. Иначе, в случае падения приложения “Биллинг ТС” эти заявки будут утеряны и счета по ним не будут подготовлены.

### Интеграция Okdesk с парковочной системой

Компания  “Рога и копыта” разработало приложение “Parking 3125, которое реализует автоматическую регистрацию пропусков в парковочной системе, когда в Okdesk создается соответствующая заявка. Но иногда парковочная система не отвечает на запросы к ней. В этом случае пропуска остаются не зарегистрированными. Внедрение сервиса очередей позволит сохранить запросы, которые должны быть отправлены в парковочную систему и реализовать попытки доставки с настраиваемой политикой повторов и временной изоляцией ошибок.

## Действующие лица проекта

…

## Ограничения

Срок выполнения: 6 календарных месяцев

Суммарные затраты: не более 5 000 рублей

## Ресурсы:

Backend-разработчик (Node.js / NestJS) с опытом интеграций и базовым DevOps

9 календарных месяцев

VDS сервер на Ubuntu на 40 гб диска, 2 гб RAM, 1 CPU

## Масштаб для MVP

В рамках MVP трансформация payload и сложные маршруты доставки не реализуются.

### 1. Приём событий

- HTTP API для приёма событий
- Валидация входных данных
- Генерация уникального eventId

---

### 2. Хранение событий

- Сохранение payload в Postgres
- Статус события:
    - `PENDING`
    - `PROCESSING`
    - `DELIVERED`
    - `FAILED`

---

### 3. Асинхронная доставка

- Очередь (RabbitMQ)
- Consumer для обработки событий
- Отправка событий в целевую систему

---

### 4. Повторы и ошибки

- Retry с задержкой
- Лимит попыток
- Dead-letter очередь

---

### 5. Наблюдаемость (минимум)

- Логи
- Endpoint healthcheck
- API для получения статуса события

## Этапы

### 1. Приём событий

Дедлайн: 08.02.2026

### 2. Хранение событий

Дедлайн: 15.02.2026

### 3. Асинхронная доставка

Дедлайн: 12.04.2026

### 4. Повторы и ошибки

Дедлайн: 03.05.2026

### 5. Наблюдаемость (минимум)

Дедлайн: 31.05.2026

Итоговый дедлайн: 01.06.2026

## Риски

1. Недостаточная надежность сервиса очередей
2. Неэффективная обработка запросов сервисом очередей. Слишком долгая обработка.
3. Нарушение целостности при обмене данными
4. Переполнение памяти сервиса. Слишком большая очередь

## Критерии успеха

1. Сервис управления интеграциями, который позволяет обеспечить управление интеграциями и гарантированную доставку событий между системами. При этом данные доставляются точно туда, куда нужно.
2. Сервис обрабатывает входящие запросы быстрее чем за 5 секунд.
3. Сервис способен хранит условно неограниченно длинные очереди.